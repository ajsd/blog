/*! blog - v0.0.0 - 2013-07-12
* Copyright (c) 2013 arunjit; Licensed MIT */
!function(){"use strict";var a=angular.module("angular-markdown",[]);a.directive("markdown",function(){var a=new Showdown.converter;return{restrict:"E",require:"?ngModel",link:function(b,c,d,e){var f=d.extensions,g=!1;if(f){var h=[];f.split(",").forEach(function(a){h.push(a.replace(/^\s+|\s+$/g,""))}),h.indexOf("prettify")>=0&&(g=!0),a=new Showdown.converter({extensions:h})}var i=d.strip;i="true"==String(i).toLowerCase()?!0:!1;var j=function(){var b="",f="";d.ngModel?e.$modelValue&&(f=e.$modelValue):f=c.text(),i&&(f=f.replace(/^[ /t]+/g,"").replace(/\n[ /t]+/g,"\n")),b=a.makeHtml(f),c.html(b),g&&prettyPrint()};d.ngModel&&b.$watch(d.ngModel,j),j()}}}),angular.module("uuid",[]).service("uuid4",function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";this.generate=function(){return a.replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"===a?b:8|3&b;return c.toString(16)})}}),angular.module("jsonrpc",["uuid"]).provider("jsonrpc",function(){var a=this.defaults={};a.basePath="/rpc",this.$get=["$http","uuid4",function(b,c){function d(d,e){var f=c.generate(),g={jsonrpc:"2.0",method:d.method,id:f};angular.isDefined(d.data)&&(g.params=d.data);var h=[];angular.forEach(b.defaults.transformResponse,function(a){h.push(a)}),h.push(function(a){return a.id===f?a.result||a.error:null}),e=e||{};var i=e.transformResponse;return angular.isArray(i)?[].push.apply(h,i):angular.isFunction(i)&&h.push(i),e.transformResponse=h,b.post(d.path||a.basePath,g,e)}function e(a,b){this.serviceName=a,this.path=b}return d.request=function(a,b,c,e){return arguments.length<4&&(e=c,c=b,b=a,a=null),d({path:a,method:b,data:c},e)},e.prototype.createMethod=function(a,b){var c=this.path,e=this.serviceName+"."+a;return function(a){return d.request(c,e,a,b)}},d.newService=function(a,b){return new e(a,b)},d}],this.setBasePath=function(a){return this.defaults.basePath=a,this}}),angular.module("main",["angular-markdown","jsonrpc"]),angular.module("main").constant("serverHost",window.location.href.indexOf("localhost")>-1?"http://localhost:8080":"https://arunjit-goblog.appspot.com"),angular.module("main").config(["$routeProvider","$locationProvider","jsonrpcProvider","serverHost",function(a,b,c,d){c.setBasePath(d+"/rpc"),b.html5Mode(!1),a.when("/",{templateUrl:"views/entries.html",controller:"EntriesCtrl"}).when("/writer",{templateUrl:"views/writer.html",controller:"WriterCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("main").service("blogService",["jsonrpc",function(a){var b=a.newService("blog");this.search=b.createMethod("Search"),this.save=b.createMethod("Save",{withCredentials:!0})}]),angular.module("main").controller("EntriesCtrl",["$scope","blogService",function(a,b){a.entries=[],b.search({q:"*"}).success(function(b){a.entries=b.entries})}]),angular.module("main").controller("WriterCtrl",["$scope","$location","blogService",function(a,b,c){var d=a.writer={};d.md="",d.error="",d.saving=!1,d.save=function(a){d.error="",d.saving=!0,c.save({md:a}).success(function(){d.saving=!1,b.path("/")}).error(function(a){d.error=a.message,d.saving=!1})}}])}();